<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="baidu-site-verification" content="1EB8XoOl0C"><meta name="google-site-verification" content="K7thEgdLm0UfRWJ5MGdF7sCcjClSzAlxFLPv2Oz5CGM"><title> ⭐️jieba分词原理解读 · Hexo</title><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="description" content="⭐️jieba分词原理解读 - John Doe"><meta name="keywords"><meta name="author" content="John Doe"><link rel="short icon" href="https://bubuzou.oss-cn-shenzhen.aliyuncs.com/blog/202010/favicon.ico"><link rel="stylesheet" href="https://bubuzou.oss-cn-shenzhen.aliyuncs.com/blog/202010/bubuzou.css"><link rel="search" type="application/opensearchdescription+xml" href="http://example.com/atom.xml" title="Hexo"><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src='//unpkg.com/valine/dist/Valine.min.js'></script><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
</head><body><header><div class="header row"> <a href="/" class="logo-link"><img src="/images/logo.png"></a><ul id="nav_list" class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" data-hover="博文" class="nav-list-link">博文</a></li><li class="nav-list-item"><a href="/archives/" target="_self" data-hover="归档" class="nav-list-link">归档</a></li><li class="nav-list-item"><a href="/about/" target="_self" data-hover="关于" class="nav-list-link">关于</a></li></ul><div class="search"><a id="search_btn" href="#search"></a></div><div id="nav_btn" class="nav-btn"><span></span><span></span><span></span></div></div></header><div class="row scroll-con"><section class="container"><!-- for archive page--><div id="postAr" class="post"><article class="post-block"><h1 class="post-title">⭐️jieba分词原理解读</h1><div class="post-info">2021-05-30</div><div class="post-content"><span id="more"></span>



<h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><ul>
<li>基于前缀词典实现高效的词图扫描，生成句子中汉字所有可能成词情况所构成的有向无环图(DAG)</li>
<li>采用了动态规划查找最大概率路径, 找出基于词频的最大切分组合</li>
<li>对于未登录词，采用了基于汉字成词能力的HMM 模型，使用了Viterbi 算法</li>
</ul>
<h2 id="前缀词典"><a href="#前缀词典" class="headerlink" title="前缀词典"></a>前缀词典</h2><p><code>self.FREQ, self.total = self.gen_pfdict(self.get_dict_file())</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@staticmethod</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen_pfdict</span>(<span class="params">f</span>):</span></span><br><span class="line">    lfreq = &#123;&#125;</span><br><span class="line">    ltotal = <span class="number">0</span></span><br><span class="line">    f_name = resolve_filename(f)</span><br><span class="line">    <span class="keyword">for</span> lineno, line <span class="keyword">in</span> <span class="built_in">enumerate</span>(f, <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            line = line.strip().decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">            word, freq = line.split(<span class="string">&#x27; &#x27;</span>)[:<span class="number">2</span>]</span><br><span class="line">            freq = <span class="built_in">int</span>(freq)</span><br><span class="line">            lfreq[word] = freq</span><br><span class="line">            ltotal += freq</span><br><span class="line">            <span class="keyword">for</span> ch <span class="keyword">in</span> xrange(<span class="built_in">len</span>(word)):</span><br><span class="line">                wfrag = word[:ch + <span class="number">1</span>]</span><br><span class="line">                <span class="keyword">if</span> wfrag <span class="keyword">not</span> <span class="keyword">in</span> lfreq:</span><br><span class="line">                    lfreq[wfrag] = <span class="number">0</span></span><br><span class="line">        <span class="keyword">except</span> ValueError:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(</span><br><span class="line">                <span class="string">&#x27;invalid dictionary entry in %s at Line %s: %s&#x27;</span> % (f_name, lineno, line))</span><br><span class="line">    f.close()</span><br><span class="line">    <span class="keyword">return</span> lfreq, ltotal</span><br></pre></td></tr></table></figure>

<h2 id="Tokenizer-cut"><a href="#Tokenizer-cut" class="headerlink" title="Tokenizer.cut()"></a>Tokenizer.cut()</h2><p>以对句子 ’我来到清华大学‘分词为例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#encoding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> unicode_literals</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">sys.path.append(<span class="string">&quot;../&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> jieba</span><br><span class="line"></span><br><span class="line">seg_list = jieba.cut(<span class="string">&quot;我来到 我来到北京清华大学&quot;</span>, cut_all=<span class="literal">False</span>)</span><br><span class="line"><span class="built_in">print</span>(seg_list)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Default Mode: &quot;</span> + <span class="string">&quot;/ &quot;</span>.join(seg_list))  <span class="comment"># 默认模式</span></span><br></pre></td></tr></table></figure>

<p>调用<strong>类Tokenizer</strong> 中cut() 方法 </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cut</span>(<span class="params">self, sentence, cut_all=<span class="literal">False</span>, HMM=<span class="literal">True</span>, use_paddle=<span class="literal">False</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The main function that segments an entire sentence that contains</span></span><br><span class="line"><span class="string">    Chinese characters into separated words.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Parameter:</span></span><br><span class="line"><span class="string">        - sentence: The str(unicode) to be segmented.</span></span><br><span class="line"><span class="string">        - cut_all: Model type. True for full pattern, False for accurate pattern.</span></span><br><span class="line"><span class="string">        - HMM: Whether to use the Hidden Markov Model.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    re_han = re_han_default</span><br><span class="line">    re_skip = re_skip_default</span><br><span class="line">    <span class="keyword">if</span> cut_all:</span><br><span class="line">        cut_block = self.__cut_all</span><br><span class="line">    <span class="keyword">elif</span> HMM:</span><br><span class="line">        cut_block = self.__cut_DAG  <span class="comment"># 有向无环图 (DAG)------（1）</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        cut_block = self.__cut_DAG_NO_HMM</span><br><span class="line">    blocks = re_han.split(sentence)  <span class="comment"># [&#x27;&#x27;, &#x27;我来到北京清华大学&#x27;, &#x27;&#x27;]</span></span><br><span class="line">    <span class="keyword">for</span> blk <span class="keyword">in</span> blocks:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> blk:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">if</span> re_han.match(blk):  <span class="comment"># 如果有意义，即内容在 re_han 匹配里面</span></span><br><span class="line">            <span class="keyword">for</span> word <span class="keyword">in</span> cut_block(blk):</span><br><span class="line">                <span class="keyword">yield</span> word</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            tmp = re_skip.split(blk)</span><br><span class="line">            <span class="keyword">for</span> x <span class="keyword">in</span> tmp:</span><br><span class="line">                <span class="keyword">if</span> re_skip.match(x):</span><br><span class="line">                    <span class="keyword">yield</span> x</span><br><span class="line">                <span class="keyword">elif</span> <span class="keyword">not</span> cut_all:</span><br><span class="line">                    <span class="keyword">for</span> xx <span class="keyword">in</span> x:</span><br><span class="line">                        <span class="keyword">yield</span> xx</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">yield</span> x</span><br></pre></td></tr></table></figure>

<p>（1）cut_block 调用下面代码，进行DAG 的生成和概率计算：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__cut_DAG</span>(<span class="params">self, sentence</span>):</span></span><br><span class="line">    DAG = self.get_DAG(sentence)				<span class="comment"># ---------1.1  &#123;0: [0], 1: [1, 2], 2: [2], 3: [3, 4], 4: [4], 5: [5, 6, 8], 6: [6, 7], 7: [7, 8], 8: [8]&#125;</span></span><br><span class="line">    route = &#123;&#125;</span><br><span class="line">    self.calc(sentence, DAG, route)			<span class="comment"># ---------1.2，计算概率，修改 route</span></span><br><span class="line">    x = <span class="number">0</span></span><br><span class="line">    buf = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    N = <span class="built_in">len</span>(sentence)</span><br><span class="line">    <span class="keyword">while</span> x &lt; N:</span><br><span class="line">        y = route[x][<span class="number">1</span>] + <span class="number">1</span></span><br><span class="line">        l_word = sentence[x:y]</span><br><span class="line">        <span class="keyword">if</span> y - x == <span class="number">1</span>:</span><br><span class="line">            buf += l_word</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> buf:</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">len</span>(buf) == <span class="number">1</span>:</span><br><span class="line">                    <span class="keyword">yield</span> buf</span><br><span class="line">                    buf = <span class="string">&#x27;&#x27;</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">if</span> <span class="keyword">not</span> self.FREQ.get(buf):</span><br><span class="line">                        recognized = finalseg.cut(buf)  <span class="comment"># ---------1.3，HMM维特比</span></span><br><span class="line">                        <span class="keyword">for</span> t <span class="keyword">in</span> recognized:</span><br><span class="line">                            <span class="keyword">yield</span> t</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        <span class="keyword">for</span> elem <span class="keyword">in</span> buf:</span><br><span class="line">                            <span class="keyword">yield</span> elem</span><br><span class="line">                    buf = <span class="string">&#x27;&#x27;</span></span><br><span class="line">            <span class="keyword">yield</span> l_word</span><br><span class="line">        x = y</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> buf:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(buf) == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">yield</span> buf</span><br><span class="line">        <span class="keyword">elif</span> <span class="keyword">not</span> self.FREQ.get(buf):</span><br><span class="line">            recognized = finalseg.cut(buf)</span><br><span class="line">            <span class="keyword">for</span> t <span class="keyword">in</span> recognized:</span><br><span class="line">                <span class="keyword">yield</span> t</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">for</span> elem <span class="keyword">in</span> buf:</span><br><span class="line">                <span class="keyword">yield</span> elem</span><br></pre></td></tr></table></figure>

<p>route:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">dict</span>&#x27;&gt;:</span> &#123;<span class="number">9</span>: (<span class="number">0</span>, <span class="number">0</span>), <span class="number">8</span>: (-<span class="number">8.142626068614787</span>, <span class="number">8</span>), <span class="number">7</span>: (-<span class="number">8.006816355818659</span>, <span class="number">8</span>), <span class="number">6</span>: (-<span class="number">17.53722513662092</span>, <span class="number">6</span>), <span class="number">5</span>: (-<span class="number">11.085007904198626</span>, <span class="number">8</span>), <span class="number">4</span>: (-<span class="number">20.20431518448597</span>, <span class="number">4</span>), <span class="number">3</span>: (-<span class="number">18.548194315526874</span>, <span class="number">4</span>), <span class="number">2</span>: (-<span class="number">24.22732015246924</span>, <span class="number">2</span>), <span class="number">1</span>: (-<span class="number">27.379629658355885</span>, <span class="number">2</span>), <span class="number">0</span>: (-<span class="number">32.587853155857076</span>, <span class="number">0</span>)&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-1-get-DAG"><a href="#1-1-get-DAG" class="headerlink" title="1.1 get_DAG()"></a>1.1 get_DAG()</h3><p>生成DAG 图，含义为一句话中每个字可以到达的有意义的位置</p>
<p>需结合 self.FREQ 词典</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_DAG</span>(<span class="params">self, sentence</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot; </span></span><br><span class="line"><span class="string">    生成有向无环图</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :param sentence: &#x27;我来到清华大学&#x27;</span></span><br><span class="line"><span class="string">    :return: &#123;0: [0], 1: [1, 2], 2: [2], 3: [3, 4], 4: [4], 5: [5, 6, 8], 6: [6, 7], 7: [7, 8], 8: [8]&#125;</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    self.check_initialized()</span><br><span class="line">    DAG = &#123;&#125;</span><br><span class="line">    N = <span class="built_in">len</span>(sentence)</span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> xrange(N):</span><br><span class="line">        tmplist = []</span><br><span class="line">        i = k</span><br><span class="line">        frag = sentence[k]</span><br><span class="line">        <span class="keyword">while</span> i &lt; N <span class="keyword">and</span> frag <span class="keyword">in</span> self.FREQ:  <span class="comment"># 只要不在就终止判断了，结合词典</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;frag&#125;</span>: <span class="subst">&#123;self.FREQ[frag]&#125;</span>&#x27;</span> ) ---------（<span class="number">1.1</span><span class="number">.1</span>）</span><br><span class="line">            <span class="keyword">if</span> self.FREQ[frag]:  <span class="comment"># 如果词频不为0</span></span><br><span class="line">                tmplist.append(i)</span><br><span class="line">            i += <span class="number">1</span></span><br><span class="line">            frag = sentence[k:i + <span class="number">1</span>]</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> tmplist:  <span class="comment"># tmplist为空</span></span><br><span class="line">            tmplist.append(k)</span><br><span class="line">        DAG[k] = tmplist</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;DAG:<span class="subst">&#123;DAG&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> DAG</span><br></pre></td></tr></table></figure>

<p>frag  显示过程如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">我: <span class="number">328841</span></span><br><span class="line">来: <span class="number">161501</span></span><br><span class="line">来到: <span class="number">8779</span></span><br><span class="line">到: <span class="number">205341</span></span><br><span class="line">北: <span class="number">17860</span></span><br><span class="line">北京: <span class="number">34488</span></span><br><span class="line">京: <span class="number">6583</span></span><br><span class="line">清: <span class="number">17519</span>-----<span class="number">5</span></span><br><span class="line">清华: <span class="number">1057</span>----<span class="number">6</span></span><br><span class="line">清华大: <span class="number">0</span>  <span class="comment"># 注意</span></span><br><span class="line">清华大学: <span class="number">922</span>---<span class="number">8</span></span><br><span class="line">华: <span class="number">4364</span></span><br><span class="line">华大: <span class="number">12</span></span><br><span class="line">大: <span class="number">144099</span></span><br><span class="line">大学: <span class="number">20025</span></span><br><span class="line">学: <span class="number">17482</span></span><br></pre></td></tr></table></figure>

<p>以 ‘清’ 为例，5: [5, 6, 8]表示，从‘清’出发，可以分出：清，清华，清华大学。刚好对应下图的三条路径</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1grvue0pwggj318409umyl.jpg" alt="image-20210626182531251"></p>
<h3 id="1-2-calc"><a href="#1-2-calc" class="headerlink" title="1.2 calc()"></a>1.2 calc()</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">calc</span>(<span class="params">self, sentence, DAG, route</span>):</span></span><br><span class="line">    N = <span class="built_in">len</span>(sentence)</span><br><span class="line">    route[N] = (<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">    logtotal = log(self.total)</span><br><span class="line">    <span class="keyword">for</span> idx <span class="keyword">in</span> xrange(N - <span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>):  <span class="comment"># 倒着取值</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;-&#x27;</span> * <span class="number">10</span>)</span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> DAG[idx]:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&#x27;考察词为：<span class="subst">&#123;sentence[idx:x + <span class="number">1</span>]&#125;</span>&#x27;</span>)</span><br><span class="line">            freq = self.FREQ.get(sentence[idx:x + <span class="number">1</span>]) <span class="keyword">or</span> <span class="number">1</span>  <span class="comment"># 获取</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&#x27;后一个词概率为：<span class="subst">&#123;route[x + <span class="number">1</span>][<span class="number">0</span>]&#125;</span>&#x27;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&#x27;当前词概率为：<span class="subst">&#123;log(freq) - logtotal&#125;</span>&#x27;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&#x27;【<span class="subst">&#123;sentence[idx:x + <span class="number">1</span>]&#125;</span>】概率计算: <span class="subst">&#123;(log(freq) - logtotal + route[x + <span class="number">1</span>][<span class="number">0</span>], x)&#125;</span>&#x27;</span>)</span><br><span class="line">        <span class="comment"># -------</span></span><br><span class="line">        route[idx] = <span class="built_in">max</span>(</span><br><span class="line">            (log(self.FREQ.get(sentence[idx:x + <span class="number">1</span>]) <span class="keyword">or</span> <span class="number">1</span>) - logtotal + route[x + <span class="number">1</span>][<span class="number">0</span>], x) <span class="keyword">for</span> x <span class="keyword">in</span> DAG[idx])</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;route: <span class="subst">&#123;route&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>采用动态规划，计算逆向最大匹配</p>
<p>其实是一个概率相乘问题，用对数后变为相加</p>
<p>根据上一步的<code>DAG：&#123;0: [0], 1: [1, 2], 2: [2], 3: [3, 4], 4: [4], 5: [5, 6, 8], 6: [6, 7], 7: [7, 8], 8: [8]&#125;</code>，进行倒序计算</p>
<p>过程如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">----------</span><br><span class="line">考察词为：学</span><br><span class="line">后一个词概率为：<span class="number">0</span></span><br><span class="line">当前词概率为：-<span class="number">8.142626068614787</span></span><br><span class="line">【学】概率计算: (-<span class="number">8.142626068614787</span>, <span class="number">8</span>)</span><br><span class="line">route: &#123;<span class="number">9</span>: (<span class="number">0</span>, <span class="number">0</span>), <span class="number">8</span>: (-<span class="number">8.142626068614787</span>, <span class="number">8</span>)&#125;</span><br><span class="line">----------</span><br><span class="line">考察词为：大</span><br><span class="line">后一个词概率为：-<span class="number">8.142626068614787</span></span><br><span class="line">当前词概率为：-<span class="number">6.033297285416946</span></span><br><span class="line">【大】概率计算: (-<span class="number">14.175923354031733</span>, <span class="number">7</span>)</span><br><span class="line">考察词为：大学</span><br><span class="line">后一个词概率为：<span class="number">0</span></span><br><span class="line">当前词概率为：-<span class="number">8.006816355818659</span></span><br><span class="line">【大学】概率计算: (-<span class="number">8.006816355818659</span>, <span class="number">8</span>)</span><br><span class="line">route: &#123;<span class="number">9</span>: (<span class="number">0</span>, <span class="number">0</span>), <span class="number">8</span>: (-<span class="number">8.142626068614787</span>, <span class="number">8</span>), <span class="number">7</span>: (-<span class="number">8.006816355818659</span>, <span class="number">8</span>)&#125;</span><br><span class="line">----------</span><br><span class="line">考察词为：华</span><br><span class="line">后一个词概率为：-<span class="number">8.006816355818659</span></span><br><span class="line">当前词概率为：-<span class="number">9.530408780802258</span></span><br><span class="line">【华】概率计算: (-<span class="number">17.53722513662092</span>, <span class="number">6</span>)</span><br><span class="line">考察词为：华大</span><br><span class="line">后一个词概率为：-<span class="number">8.142626068614787</span></span><br><span class="line">当前词概率为：-<span class="number">15.42664647796722</span></span><br><span class="line">【华大】概率计算: (-<span class="number">23.569272546582006</span>, <span class="number">7</span>)</span><br><span class="line">route: &#123;<span class="number">9</span>: (<span class="number">0</span>, <span class="number">0</span>), <span class="number">8</span>: (-<span class="number">8.142626068614787</span>, <span class="number">8</span>), <span class="number">7</span>: (-<span class="number">8.006816355818659</span>, <span class="number">8</span>), <span class="number">6</span>: (-<span class="number">17.53722513662092</span>, <span class="number">6</span>)&#125;</span><br><span class="line">----------</span><br><span class="line">考察词为：清</span><br><span class="line">后一个词概率为：-<span class="number">17.53722513662092</span></span><br><span class="line">当前词概率为：-<span class="number">8.140511842519397</span></span><br><span class="line">【清】概率计算: (-<span class="number">25.677736979140313</span>, <span class="number">5</span>)</span><br><span class="line">考察词为：清华</span><br><span class="line">后一个词概率为：-<span class="number">8.006816355818659</span></span><br><span class="line">当前词概率为：-<span class="number">10.948363141884982</span></span><br><span class="line">【清华】概率计算: (-<span class="number">18.95517949770364</span>, <span class="number">6</span>)</span><br><span class="line">考察词为：清华大学</span><br><span class="line">后一个词概率为：<span class="number">0</span></span><br><span class="line">当前词概率为：-<span class="number">11.085007904198626</span></span><br><span class="line">【清华大学】概率计算: (-<span class="number">11.085007904198626</span>, <span class="number">8</span>)</span><br><span class="line">route: &#123;<span class="number">9</span>: (<span class="number">0</span>, <span class="number">0</span>), <span class="number">8</span>: (-<span class="number">8.142626068614787</span>, <span class="number">8</span>), <span class="number">7</span>: (-<span class="number">8.006816355818659</span>, <span class="number">8</span>), <span class="number">6</span>: (-<span class="number">17.53722513662092</span>, <span class="number">6</span>), <span class="number">5</span>: (-<span class="number">11.085007904198626</span>, <span class="number">8</span>)&#125;</span><br><span class="line">----------</span><br><span class="line">考察词为：京</span><br><span class="line">后一个词概率为：-<span class="number">11.085007904198626</span></span><br><span class="line">当前词概率为：-<span class="number">9.119307280287343</span></span><br><span class="line">【京】概率计算: (-<span class="number">20.20431518448597</span>, <span class="number">4</span>)</span><br><span class="line">route: &#123;<span class="number">9</span>: (<span class="number">0</span>, <span class="number">0</span>), <span class="number">8</span>: (-<span class="number">8.142626068614787</span>, <span class="number">8</span>), <span class="number">7</span>: (-<span class="number">8.006816355818659</span>, <span class="number">8</span>), <span class="number">6</span>: (-<span class="number">17.53722513662092</span>, <span class="number">6</span>), <span class="number">5</span>: (-<span class="number">11.085007904198626</span>, <span class="number">8</span>), <span class="number">4</span>: (-<span class="number">20.20431518448597</span>, <span class="number">4</span>)&#125;</span><br><span class="line">----------</span><br><span class="line">考察词为：北</span><br><span class="line">后一个词概率为：-<span class="number">20.20431518448597</span></span><br><span class="line">当前词概率为：-<span class="number">8.12123427332473</span></span><br><span class="line">【北】概率计算: (-<span class="number">28.325549457810702</span>, <span class="number">3</span>)</span><br><span class="line">考察词为：北京</span><br><span class="line">后一个词概率为：-<span class="number">11.085007904198626</span></span><br><span class="line">当前词概率为：-<span class="number">7.463186411328248</span></span><br><span class="line">【北京】概率计算: (-<span class="number">18.548194315526874</span>, <span class="number">4</span>)</span><br><span class="line">route: &#123;<span class="number">9</span>: (<span class="number">0</span>, <span class="number">0</span>), <span class="number">8</span>: (-<span class="number">8.142626068614787</span>, <span class="number">8</span>), <span class="number">7</span>: (-<span class="number">8.006816355818659</span>, <span class="number">8</span>), <span class="number">6</span>: (-<span class="number">17.53722513662092</span>, <span class="number">6</span>), <span class="number">5</span>: (-<span class="number">11.085007904198626</span>, <span class="number">8</span>), <span class="number">4</span>: (-<span class="number">20.20431518448597</span>, <span class="number">4</span>), <span class="number">3</span>: (-<span class="number">18.548194315526874</span>, <span class="number">4</span>)&#125;</span><br><span class="line">----------</span><br><span class="line">考察词为：到</span><br><span class="line">后一个词概率为：-<span class="number">18.548194315526874</span></span><br><span class="line">当前词概率为：-<span class="number">5.679125836942367</span></span><br><span class="line">【到】概率计算: (-<span class="number">24.22732015246924</span>, <span class="number">2</span>)</span><br><span class="line">route: &#123;<span class="number">9</span>: (<span class="number">0</span>, <span class="number">0</span>), <span class="number">8</span>: (-<span class="number">8.142626068614787</span>, <span class="number">8</span>), <span class="number">7</span>: (-<span class="number">8.006816355818659</span>, <span class="number">8</span>), <span class="number">6</span>: (-<span class="number">17.53722513662092</span>, <span class="number">6</span>), <span class="number">5</span>: (-<span class="number">11.085007904198626</span>, <span class="number">8</span>), <span class="number">4</span>: (-<span class="number">20.20431518448597</span>, <span class="number">4</span>), <span class="number">3</span>: (-<span class="number">18.548194315526874</span>, <span class="number">4</span>), <span class="number">2</span>: (-<span class="number">24.22732015246924</span>, <span class="number">2</span>)&#125;</span><br><span class="line">----------</span><br><span class="line">考察词为：来</span><br><span class="line">后一个词概率为：-<span class="number">24.22732015246924</span></span><br><span class="line">当前词概率为：-<span class="number">5.919286514179078</span></span><br><span class="line">【来】概率计算: (-<span class="number">30.146606666648317</span>, <span class="number">1</span>)</span><br><span class="line">考察词为：来到</span><br><span class="line">后一个词概率为：-<span class="number">18.548194315526874</span></span><br><span class="line">当前词概率为：-<span class="number">8.83143534282901</span></span><br><span class="line">【来到】概率计算: (-<span class="number">27.379629658355885</span>, <span class="number">2</span>)</span><br><span class="line">route: &#123;<span class="number">9</span>: (<span class="number">0</span>, <span class="number">0</span>), <span class="number">8</span>: (-<span class="number">8.142626068614787</span>, <span class="number">8</span>), <span class="number">7</span>: (-<span class="number">8.006816355818659</span>, <span class="number">8</span>), <span class="number">6</span>: (-<span class="number">17.53722513662092</span>, <span class="number">6</span>), <span class="number">5</span>: (-<span class="number">11.085007904198626</span>, <span class="number">8</span>), <span class="number">4</span>: (-<span class="number">20.20431518448597</span>, <span class="number">4</span>), <span class="number">3</span>: (-<span class="number">18.548194315526874</span>, <span class="number">4</span>), <span class="number">2</span>: (-<span class="number">24.22732015246924</span>, <span class="number">2</span>), <span class="number">1</span>: (-<span class="number">27.379629658355885</span>, <span class="number">2</span>)&#125;</span><br><span class="line">----------</span><br><span class="line">考察词为：我</span><br><span class="line">后一个词概率为：-<span class="number">27.379629658355885</span></span><br><span class="line">当前词概率为：-<span class="number">5.208223497501194</span></span><br><span class="line">【我】概率计算: (-<span class="number">32.587853155857076</span>, <span class="number">0</span>)</span><br><span class="line">route: &#123;<span class="number">9</span>: (<span class="number">0</span>, <span class="number">0</span>), <span class="number">8</span>: (-<span class="number">8.142626068614787</span>, <span class="number">8</span>), <span class="number">7</span>: (-<span class="number">8.006816355818659</span>, <span class="number">8</span>), <span class="number">6</span>: (-<span class="number">17.53722513662092</span>, <span class="number">6</span>), <span class="number">5</span>: (-<span class="number">11.085007904198626</span>, <span class="number">8</span>), <span class="number">4</span>: (-<span class="number">20.20431518448597</span>, <span class="number">4</span>), <span class="number">3</span>: (-<span class="number">18.548194315526874</span>, <span class="number">4</span>), <span class="number">2</span>: (-<span class="number">24.22732015246924</span>, <span class="number">2</span>), <span class="number">1</span>: (-<span class="number">27.379629658355885</span>, <span class="number">2</span>), <span class="number">0</span>: (-<span class="number">32.587853155857076</span>, <span class="number">0</span>)&#125;</span><br><span class="line">route: &#123;<span class="number">9</span>: (<span class="number">0</span>, <span class="number">0</span>), <span class="number">8</span>: (-<span class="number">8.142626068614787</span>, <span class="number">8</span>), <span class="number">7</span>: (-<span class="number">8.006816355818659</span>, <span class="number">8</span>), <span class="number">6</span>: (-<span class="number">17.53722513662092</span>, <span class="number">6</span>), <span class="number">5</span>: (-<span class="number">11.085007904198626</span>, <span class="number">8</span>), <span class="number">4</span>: (-<span class="number">20.20431518448597</span>, <span class="number">4</span>), <span class="number">3</span>: (-<span class="number">18.548194315526874</span>, <span class="number">4</span>), <span class="number">2</span>: (-<span class="number">24.22732015246924</span>, <span class="number">2</span>), <span class="number">1</span>: (-<span class="number">27.379629658355885</span>, <span class="number">2</span>), <span class="number">0</span>: (-<span class="number">32.587853155857076</span>, <span class="number">0</span>)&#125;</span><br><span class="line">Default Mode: 我/ 来到/ 北京/ 清华大学</span><br></pre></td></tr></table></figure>

<h3 id="1-3-finalseg-cut"><a href="#1-3-finalseg-cut" class="headerlink" title="1.3 finalseg.cut()"></a>1.3 finalseg.cut()</h3><p>使用维特比算法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__cut</span>(<span class="params">sentence</span>):</span></span><br><span class="line">    <span class="keyword">global</span> emit_P</span><br><span class="line">    prob, pos_list = viterbi(sentence, <span class="string">&#x27;BMES&#x27;</span>, start_P, trans_P, emit_P)</span><br><span class="line">    begin, nexti = <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">    <span class="comment"># print pos_list, sentence</span></span><br><span class="line">    <span class="keyword">for</span> i, char <span class="keyword">in</span> <span class="built_in">enumerate</span>(sentence):</span><br><span class="line">        pos = pos_list[i]</span><br><span class="line">        <span class="keyword">if</span> pos == <span class="string">&#x27;B&#x27;</span>:</span><br><span class="line">            begin = i</span><br><span class="line">        <span class="keyword">elif</span> pos == <span class="string">&#x27;E&#x27;</span>:</span><br><span class="line">            <span class="keyword">yield</span> sentence[begin:i + <span class="number">1</span>]</span><br><span class="line">            nexti = i + <span class="number">1</span></span><br><span class="line">        <span class="keyword">elif</span> pos == <span class="string">&#x27;S&#x27;</span>:</span><br><span class="line">            <span class="keyword">yield</span> char</span><br><span class="line">            nexti = i + <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> nexti &lt; <span class="built_in">len</span>(sentence):</span><br><span class="line">        <span class="keyword">yield</span> sentence[nexti:]</span><br></pre></td></tr></table></figure>

<h2 id="特殊修改"><a href="#特殊修改" class="headerlink" title="特殊修改"></a>特殊修改</h2><p>1）jieba.load_userdict 对标点符号失效</p>
<p><a target="_blank" rel="noopener" href="https://github.com/fxsjy/jieba/issues/749">https://github.com/fxsjy/jieba/issues/749</a></p>
<blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># user_dict 如&quot;糖类抗原19-9 9999&quot;</span><br><span class="line">import jieba</span><br><span class="line"></span><br><span class="line">jieba.load_userdict(&#x27;user_dict.txt&#x27;)</span><br><span class="line">list(jieba.cut(&#x27;糖类抗原19-9&#x27;)) # [&#x27;糖类&#x27;, &#x27;抗原&#x27;, &#x27;19&#x27;, &#x27;-&#x27;, &#x27;9&#x27;]</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>jieba的__init__.py里面的第43行改成如下所示：<br>re_han_default = re.compile(“([\u4E00-\u9FD5a-zA-Z0-9+#&amp;._%-]+)”, re.U)</p>
</blockquote>
<p>2）关键词带空格和特殊字符方法</p>
<p>参考：<a target="_blank" rel="noopener" href="https://github.com/fxsjy/jieba/issues/423">https://github.com/fxsjy/jieba/issues/423</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">免费分享，造损免责。</span><br><span class="line">打开默认词典（根目录）或自定义词典，把所有用来间隔词频和词性的空格间隔符改成@@</span><br><span class="line">（选用@@是因为一般关键词里遇到这个分隔符的几率比较小吧）</span><br><span class="line"></span><br><span class="line">继续，打开jieba根目录下init.py</span><br><span class="line"></span><br><span class="line"><span class="number">1.</span> 搜索✅</span><br><span class="line">re_han_default = re.<span class="built_in">compile</span>(<span class="string">&quot;([\u4E00-\u9FD5a-zA-Z0-9+#&amp;\._]+)&quot;</span>, re.U)</span><br><span class="line">改成</span><br><span class="line">re_han_default = re.<span class="built_in">compile</span>(<span class="string">&quot;(.+)&quot;</span>, re.U)</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> 搜索✅</span><br><span class="line">re_userdict = re.<span class="built_in">compile</span>(<span class="string">&#x27;^(.+?)( [0-9]+)?( [a-z]+)?$&#x27;</span>, re.U)</span><br><span class="line">改成</span><br><span class="line">re_userdict = re.<span class="built_in">compile</span>(<span class="string">&#x27;^(.+?)(\u0040\u0040[0-9]+)?(\u0040\u0040[a-z]+)?$&#x27;</span>, re.U)</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span> 搜索✅</span><br><span class="line">word, freq = line.split(<span class="string">&#x27; &#x27;</span>)[:<span class="number">2</span>]</span><br><span class="line">改成</span><br><span class="line">word, freq = line.split(<span class="string">&#x27;\u0040\u0040&#x27;</span>)[:<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line"><span class="number">4.</span> 补充：若用的全模式继续改。</span><br><span class="line">搜索</span><br><span class="line">re_han_cut_all = re.<span class="built_in">compile</span>(<span class="string">&quot;([\u4E00-\u9FD5]+)&quot;</span>, re.U)</span><br><span class="line">改成</span><br><span class="line">re_han_cut_all = re.<span class="built_in">compile</span>(<span class="string">&quot;(.+)&quot;</span>, re.U)</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">然后继续打开 posseg  __init__.py</span><br><span class="line"><span class="number">1.</span> 搜索</span><br><span class="line">re_han_internal = re.<span class="built_in">compile</span>(<span class="string">&quot;([\u4E00-\u9FD5a-zA-Z0-9+#&amp;\._]+)&quot;</span>)</span><br><span class="line">替换为：</span><br><span class="line">re_han_internal = re.<span class="built_in">compile</span>(<span class="string">&quot;(.+)&quot;</span>, re.U)</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> 搜索</span><br><span class="line">word, _, tag = line.split(<span class="string">&quot; &quot;</span>)</span><br><span class="line">替换为：</span><br><span class="line">word, _, tag = line.split(<span class="string">&quot;\u0040\u0040&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>搜索</span><br><span class="line">word, _, tag = line.split(<span class="string">&quot; &quot;</span>)</span><br><span class="line">替换为：</span><br><span class="line">word, _, tag = line.split(<span class="string">&quot;\u0040\u0040&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><strong>试验</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#encoding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> unicode_literals</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">sys.path.append(<span class="string">&quot;../&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> jieba</span><br><span class="line"><span class="keyword">import</span> jieba.posseg</span><br><span class="line"><span class="keyword">import</span> jieba.analyse</span><br><span class="line"></span><br><span class="line">sentence = <span class="string">&quot;我来到北京清华大学c++，并且bav99-w,2?10不错哦&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;=&#x27;</span>*<span class="number">40</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;1. 分词&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;-&#x27;</span>*<span class="number">40</span>)</span><br><span class="line">seg_list = jieba.cut(sentence, cut_all=<span class="literal">True</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Full Mode: &quot;</span> + <span class="string">&quot;/ &quot;</span>.join(seg_list))  <span class="comment"># 全模式</span></span><br><span class="line"></span><br><span class="line">seg_list = jieba.cut(sentence, cut_all=<span class="literal">False</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Default Mode: &quot;</span> + <span class="string">&quot;/ &quot;</span>.join(seg_list))  <span class="comment"># 默认模式</span></span><br><span class="line"></span><br><span class="line">seg_list = jieba.cut(sentence)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;, &quot;</span>.join(seg_list))</span><br><span class="line"></span><br><span class="line">seg_list = jieba.cut_for_search(sentence)  <span class="comment"># 搜索引擎模式</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;, &quot;</span>.join(seg_list))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;=&#x27;</span>*<span class="number">40</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;4. 词性标注&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;-&#x27;</span>*<span class="number">40</span>)</span><br><span class="line"></span><br><span class="line">words = jieba.posseg.cut(sentence)</span><br><span class="line"><span class="keyword">for</span> word, flag <span class="keyword">in</span> words:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;%s %s&#x27;</span> % (word, flag))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>原始效果如下：</li>
</ul>
<p>dict.txt</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">AT&amp;T 3 nz</span><br><span class="line">B超 3 n</span><br><span class="line">c# 3 nz</span><br><span class="line">C# 3 nz</span><br><span class="line">c++ 3 nz</span><br><span class="line">bav99-w,2?10 3000000 pn</span><br></pre></td></tr></table></figure>

<p>程序运行结果</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">========================================</span><br><span class="line"><span class="number">1.</span> 分词</span><br><span class="line">----------------------------------------</span><br><span class="line">Full Mode: 我/ 来/ 到/ 北/ 京/ 清/ 华/ 大/ 学/ c++/ ，/ 并/ 且/ bav99/ -/ w/ ,/ <span class="number">2</span>/ ?/ <span class="number">10</span>/ 不/ 错/ 哦</span><br><span class="line">Default Mode: 我来/ 到/ 北京/ 清华大学/ c++/ ，/ 并且/ bav99/ -/ w/ ,/ <span class="number">2</span>/ ?/ <span class="number">10</span>/ 不错/ 哦</span><br><span class="line">我来, 到, 北京, 清华大学, c++, ，, 并且, bav99, -, w, ,, <span class="number">2</span>, ?, <span class="number">10</span>, 不错, 哦</span><br><span class="line">我来, 到, 北京, 清华大学, c++, ，, 并且, bav99, -, w, ,, <span class="number">2</span>, ?, <span class="number">10</span>, 不错, 哦</span><br><span class="line">========================================</span><br><span class="line"><span class="number">4.</span> 词性标注</span><br><span class="line">----------------------------------------</span><br><span class="line">我 r</span><br><span class="line">来 v</span><br><span class="line">到 v</span><br><span class="line">北京 ns</span><br><span class="line">清华大学 nt</span><br><span class="line">c++ nz</span><br><span class="line">， x</span><br><span class="line">并且 c</span><br><span class="line">bav99 eng</span><br><span class="line">- x</span><br><span class="line">w x</span><br><span class="line">, x</span><br><span class="line"><span class="number">2</span> x</span><br><span class="line">? x</span><br><span class="line"><span class="number">10</span> m</span><br><span class="line">不错 a</span><br><span class="line">哦 e</span><br></pre></td></tr></table></figure>



<ul>
<li>改完后效果：</li>
</ul>
<p>dict.txt变为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">AT&amp;T@@3@@nz</span><br><span class="line">B超@@3@@n</span><br><span class="line">c#@@3@@nz</span><br><span class="line">C#@@3@@nz</span><br><span class="line">c++@@3@@nz</span><br><span class="line">bav99-w,2?10@@3@@pn</span><br><span class="line">bav99-w,2?1 0@@3@@pn</span><br></pre></td></tr></table></figure>

<p>程序运行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">========================================</span><br><span class="line"><span class="number">1.</span> 分词</span><br><span class="line">----------------------------------------</span><br><span class="line">Full Mode: 我/ 来/ 到/ 北/ 京/ 清/ 华/ 大/ 学/ c++/ ，/ 并/ 且/ bav99-w,<span class="number">2</span>?<span class="number">1</span> <span class="number">0</span>/ 不/ 错/ 哦</span><br><span class="line">Default Mode: 我来/ 到/ 北京/ 清华大学/ c++/ ，/ 并且/ bav99-w,<span class="number">2</span>?<span class="number">1</span> <span class="number">0</span>/ 不错/ 哦</span><br><span class="line">我来, 到, 北京, 清华大学, c++, ，, 并且, bav99-w,<span class="number">2</span>?<span class="number">1</span> <span class="number">0</span>, 不错, 哦</span><br><span class="line">我来, 到, 北京, 清华大学, c++, ，, 并且, bav99-w,<span class="number">2</span>?<span class="number">1</span> <span class="number">0</span>, 不错, 哦</span><br><span class="line">========================================</span><br><span class="line"><span class="number">4.</span> 词性标注</span><br><span class="line">----------------------------------------</span><br><span class="line">我 r</span><br><span class="line">来 v</span><br><span class="line">到 v</span><br><span class="line">北京 ns</span><br><span class="line">清华大学 nt</span><br><span class="line">c++ nz</span><br><span class="line">， x</span><br><span class="line">并且 c</span><br><span class="line">bav99-w,<span class="number">2</span>?<span class="number">1</span> <span class="number">0</span> pn</span><br><span class="line">不错 a</span><br><span class="line">哦 e</span><br></pre></td></tr></table></figure>

<p>甚至，<code>bav99-w,2?10</code> 变为<code>bav99-w,2?1 0</code>依旧没有问题</p>
<ul>
<li>加载自定义词库太慢的问题</li>
</ul>
<blockquote>
<p>修改完jieba默认词库,就不需要再使用 <strong>jieba.load_userdict</strong> 方法去加载自定义词库了。省去了大笔自定义词库加载的时间成本。</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/dbaa4421b4ce">解决jieba分词 load_userdict 加载自定义词库太慢的问题</a></p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ol>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/d232d344e23f">jieba分词原理</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/miner_zhu/article/details/83246153">NLP之jieba分词原理简析</a></li>
</ol>
</div></article></div><div class="right-container"><div class="widget"><div id="arAnchorBar"></div></div></div></section></div><div class="right-menu"></div><div class="modal search-modal"><div class="input-field"><input type="text" id="search_input"><label for="search-input">搜索</label></div><div id="search_result" class="search-result"></div></div><div class="blog-overlay"></div><footer class="row"><div class="footer-con"><div class="paginator"><a href="/2021/06/06/bert%E6%BA%90%E7%A0%81%E7%90%86%E8%A7%A3/" title="⭐️bert源码理解" class="prev">PREV</a><a href="/2021/04/04/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95%E4%B9%8B%E7%BE%8E%EF%BC%88%E5%8A%A0%E9%A4%90%EF%BC%89/" title="⭐️数据结构与算法之美（加餐）" class="next">NEXT</a></div><div class="copyright"><p>© 2016 - 2021 <a target="_blank">John Doe</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> <br> and <a href="https://github.com/Bulandent/hexo-theme-bubuzou" target="_blank">hexo-theme-bubuzou</a></p><p> <span style="padding-right: 6px;">闽ICP备16007301号-2</span></p></div><div class="totop"><i></i></div></div></footer><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script src="https://bubuzou.oss-cn-shenzhen.aliyuncs.com/blog/202010/jquery-1.8.2.min.js"></script><script src="https://bubuzou.oss-cn-shenzhen.aliyuncs.com/blog/202010/articleCatalog.js"></script><script src="https://bubuzou.oss-cn-shenzhen.aliyuncs.com/blog/202010/main.js"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>